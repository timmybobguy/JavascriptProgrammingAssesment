<!DOCTYPE html>
<html>
<head>
	<title> 2018 Commonwealth Games </title>
	<meta charset="utf-8">
  <!-- Source files here... -->
	<script type="text/javascript" src="src/data.json"></script>
	<script src="src/htmlFunctions.js"></script>
  <script src="src/SetExtensions.js"></script>
  <script src="src/View.js"></script>
  <script src="src/Team.js"></script>
  <script src="src/Match.js"></script>
  <script src="src/Pool.js"></script>
  <script src="src/Sport.js"></script>
  <script src="src/Tournament.js"></script>
  <script src="src/Controller.js"></script>
  <script src="src/addPoolResults.js"></script>
  <script src="src/shortNames.js"></script>
	<link rel="stylesheet" href="src/stylesheet.css">
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<!-- .................... -->
</head>

<script type = "text/javascript">
	 google.charts.load('current', {packages: ['corechart']});
</script>

<body class="container">

<header>
	<h1>The 2018 Commonwealth Games</h1>
</header>

<nav>
</nav>

<main>
</main>

<aside>
</aside>

<footer>
	This is a footer, it is at the foot of the page
</footer>

<body onload="onLoad()">
<script>

var the2018Games
the2018Games = Controller.setup()
console.log( the2018Games )

function onLoad() {
	makeParagraph(document.body.childNodes[3], "Please select the options you want")
	theSelect = makeSelect(document.body.childNodes[3], "sportSelector")
	addSelectOption(theSelect, "All Sports", 'special')
  for (var x = 0; x < the2018Games.allMySports.length; x++) {
	  addSelectOption(theSelect, the2018Games.allMySports[x].name, x, the2018Games.allMySports[x].name)
  }
	theSelect2 = makeSelect(document.body.childNodes[3], "secondSelector")
	addSelectOption(theSelect2, "Matches", 0, "Matches")
	addSelectOption(theSelect2, "Pools", 1, "Pools")
	addSelectOption(theSelect2, "Teams", 2, "Teams")
	makeButton(document.body.childNodes[3], 'View table', 'updateTables()', 'button1')
	makeParagraph(document.body.childNodes[7], "Search for teams and results etc.")
	makeInput(document.body.childNodes[7], "searchBar")
	//makeButton(document.body.childNodes[7], "Search", "searchFunction()", 'button2')

	//Statistics menu
	makeParagraph(document.body.childNodes[3], "Select a sport and team for their statistics")
	theSelect3 = makeSelect(document.body.childNodes[3], "statisticsSelector1", "statisticsFunction1()")
	addSelectOption(theSelect3, "")
	for (var x = 0; x < the2018Games.allMySports.length; x++) {
	  addSelectOption(theSelect3, the2018Games.allMySports[x].name, x, the2018Games.allMySports[x].name)
  }
	theSelect4 = makeSelect(document.body.childNodes[3], "statisticsSelector2")
	makeButton(document.body.childNodes[3], "View statistics", "viewStatistics()", "button2")

}

function statisticsFunction1() {
	removeOptions(document.getElementById("statisticsSelector2"))
	sportNumber = document.getElementsByName(document.getElementById("statisticsSelector1").value)[0].id
	for (var i = 0; i < the2018Games.allMySports[sportNumber].allMyTeams.length; i++) {
		addSelectOption(document.getElementById("statisticsSelector2"), the2018Games.allMySports[sportNumber].allMyTeams[i].name, i, the2018Games.allMySports[sportNumber].allMyTeams[i].name)
	}
}

function viewStatistics() {
	document.body.childNodes[5].innerHTML = ""
	sportNumber = document.getElementsByName(document.getElementById("statisticsSelector1").value)[0].id
	teamNumber = document.getElementsByName(document.getElementById("statisticsSelector2").value)[0].id
	theTeam = the2018Games.allMySports[sportNumber].allMyTeams[teamNumber]
	makeHeader(document.body.childNodes[5], theTeam.name + " (" + theTeam.shortName + ")")
	winPercentage = String(Math.round(((theTeam.matchesWon / theTeam.matchesPlayed) * 100) * 100) / 100) + "%"
	makeParagraph(document.body.childNodes[5], ("The " + String(document.getElementById("statisticsSelector1").value).bold() + " team of " + String(theTeam.name).bold() + " have won " + winPercentage.bold() + " of their matches."))
	makeParagraph(document.body.childNodes[5], ("They have scored " + (String(theTeam.scoreFor)).bold() + " points over the course of the games."))
	makeParagraph(document.body.childNodes[5], ("And they have had " + (String(theTeam.scoreAgainst)).bold() + " points scored against them."))
	makeParagraph(document.body.childNodes[5], "", "piechart")
	google.charts.setOnLoadCallback(drawPieChart(theTeam))
	createComparison(theTeam, sportNumber, winPercentage)
}

function createComparison(theTeam, sportNumber, winPercentage) {
	test = document.getElementById('comparisonText')
	if (test) {
		removeElement('comparisonText')
		removeOptions(document.getElementById("compareSelect"))
	} else {
		makeParagraph(document.body.childNodes[3], "-----------","space")
		theSelect = makeSelect(document.body.childNodes[3], "compareSelect")
		makeButton(document.body.childNodes[3], "Compare", "displayComparison()", "button3")
	}
	sportName = the2018Games.allMySports[sportNumber].name

	makeParagraph(document.body.childNodes[3], "Compare " + String(theTeam).bold() + " with another team from " + String(sportName).bold(), "comparisonText")


	for (var i = 0; i < the2018Games.allMySports[sportNumber].allMyTeams.length; i++) {
		if (theTeam != the2018Games.allMySports[sportNumber].allMyTeams[i].name) {
			addSelectOption(theSelect, the2018Games.allMySports[sportNumber].allMyTeams[i].name, i, the2018Games.allMySports[sportNumber].allMyTeams[i].name)
		}
	}
}

function displayComparison() {
	theTeam = document.getElementById("statisticsSelector2").value
	theTeam2 = document.getElementById("compareSelect").value
	console.log(theTeam, theTeam2)

}

function drawPieChart(theTeam) {
	var data = google.visualization.arrayToDataTable([
	['Task', 'Points scored'],
	['Points for', theTeam.scoreFor],
	['Points against', theTeam.scoreAgainst]
]);
	var options = {'width':450, 'height':300, is3D: true,};
	var chart = new google.visualization.PieChart(document.getElementById('piechart'));
	chart.draw(data, options);
}

window.addEventListener('input', function (e) {
 //console.log("input event from this element:", e.target);
 searchFunction()

}, false);


function searchFunction() {
	var searchString = document.getElementById('searchBar').value
  for (var i = 0; i < document.querySelectorAll('td').length; i++) {
  	if (document.querySelectorAll('td')[i].textContent.toUpperCase() === searchString.toUpperCase()) {
			document.querySelectorAll('td')[i].bgColor = "red"
  	} else {
			document.querySelectorAll('td')[i].bgColor = "white"
  	}
  }
}
function updateTables() {
	document.body.childNodes[5].innerHTML = ""
	sport = String(document.getElementById("sportSelector").value)
	selection = String(document.getElementById("secondSelector").value)

	//selectionNumber = document.getElementsByName(selection)[0].id
	//console.log(sportNumber, selectionNumber)


	allSportsValue = 1
	if (sport === "All Sports") {
		allSportsValue = the2018Games.allMySports.length
	} else {
		sportNumber = document.getElementsByName(sport)[0].id
		theTest = the2018Games.allMySports[sportNumber]

	}
	while (allSportsValue > 0) {
		if (sport === "All Sports") {
			//sportNumber = the2018Games.allMySports[allSportsValue - 1]
			theTest = the2018Games.allMySports[allSportsValue - 1]
			paraText = theTest.name
			makeHeader(document.body.childNodes[5], paraText)
		}

		theTable = makeTable(document.body.childNodes[5])

		if (selection === "Matches") {
			addTableHeaders(theTable, "Pool", "Team A", "Team B", "Team A Score", "Team B Score", "Date of Match")
			for (var i = 0; i < theTest.allMyMatches.length; i++) {
				addTableData(theTable, theTest.allMyMatches[i].myPool.name, theTest.allMyMatches[i].myTeamA.name, theTest.allMyMatches[i].myTeamB.name, theTest.allMyMatches[i].scoreA, theTest.allMyMatches[i].scoreB, theTest.allMyMatches[i].when)
			}
		} else if (selection === "Pools") {
			addTableHeaders(theTable, "Pool name", "Pool Teams")
			for (var i = 0; i < theTest.allMyPools.length; i++) {
				for (var x = 0; x < theTest.allMyPools[i].allMyTeams.length; x++) {
					addTableData(theTable, theTest.allMyPools[i].name, theTest.allMyPools[i].allMyTeams[x].name)
				}
			}
		} else if (selection === "Teams") {
			addTableHeaders(theTable, "Team name", "Matches won", "Matches lost", "Matches played", "Score for", "Score against")
			for (var i = 0; i < theTest.allMyTeams.length; i++) {
				addTableData(theTable, theTest.allMyTeams[i].name, theTest.allMyTeams[i].matchesWon, theTest.allMyTeams[i].matchesLost, theTest.allMyTeams[i].matchesPlayed, theTest.allMyTeams[i].scoreFor, theTest.allMyTeams[i].scoreAgainst)
			}
		}
		allSportsValue -= 1
	}
}
// This is what you would use to create a search engine: window.find(string), also get the POOL RESULTS. Also consider adding Team statistics with another selector, picking team and then displaying team wins losses etc using graphics.
/*
SEARCH THINGYYYY ------> document.getElementsByTagName('td')
removeElement("button1")
removeElement("para1")
removeElement("sportSelector")
removeElement("secondSelector")


if (document.getElementById("sportSelector").idea === "special") {
	console.log('testttttt')
} else {

}
*/



/*
Table requires id
// called from a button click or load of a document
function myFunction () { // eslint-disable-line no-unused-vars
  var theTable
  theTable = makeTable(document.body)
  addTableHeaders(theTable, 'ID', 'Grade')
  addTableData(theTable, '123123', '100')
  addTableData(theTable, '987654', '56')
  addTableData(theTable, '1231234', '34')
	theSelect = makeSelect(document.body)
	addSelectOption(theSelect, 'Test')
	addSelectOption(theSelect, 'Test1')
	addSelectOption(theSelect, 'Test2')
	addSelectOption(theSelect, 'Test3')

}
*/


</script>
</body>
</html>
